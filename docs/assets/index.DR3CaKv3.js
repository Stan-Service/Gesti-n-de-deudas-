(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))a(t);new MutationObserver(t=>{for(const i of t)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function n(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerPolicy&&(i.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?i.credentials="include":t.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(t){if(t.ep)return;t.ep=!0;const i=n(t);fetch(t.href,i)}})();class u{constructor(){this.clients=JSON.parse(localStorage.getItem("debtClients")||"[]"),this.exchangeRates=JSON.parse(localStorage.getItem("exchangeRates")||"{}"),this.globalCurrency=localStorage.getItem("globalCurrency")||"USD",this.currentDeleteId=null,this.currentDeleteOperation=null}renderClients(){const e=document.getElementById("clientsContainer"),n=document.getElementById("paidClientsContainer"),a=document.getElementById("paidClientsList"),t=document.getElementById("emptyState");e.innerHTML="",a.innerHTML="";let i=!1,o=!1;this.clients.forEach(r=>{const c=this.isPaidOff(r),d=this.createClientCard(r,c);c?(a.appendChild(d),o=!0):(e.appendChild(d),i=!0)}),e.style.display=i?"grid":"none",n.style.display=o?"block":"none",t.style.display=i?"none":"block"}createClientCard(e,n){const a=document.createElement("div");return a.className=`bg-white rounded-xl shadow p-4 flex flex-col gap-2 border border-gray-200 ${n?"opacity-60":""}`,a.innerHTML=`
      <div class="flex justify-between items-center">
        <div>
          <h3 class="text-base font-semibold">${e.name}</h3>
          <span class="text-xs text-gray-500">${this.getCurrencyLabel(e.currency||"USD")}</span>
        </div>
        <div class="flex gap-1">
          <button class="bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-400" title="Pago" ${n?"disabled":""} data-action="pay" data-id="${e.id}">‚úî</button>
          <button class="bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-400" title="Aumentar" ${n?"disabled":""} data-action="increase" data-id="${e.id}">Ôºã</button>
          <button class="bg-gray-300 text-gray-700 px-2 py-1 rounded hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-300" title="Ver historial" data-action="history" data-id="${e.id}">‚è∞</button>
          <button class="bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-400" title="Eliminar" data-action="delete" data-id="${e.id}">üóëÔ∏è</button>
        </div>
      </div>
      <div class="mt-2">
        <span class="font-bold text-lg">${this.getCurrencySymbol(this.globalCurrency)} ${this.formatAmount(this.convertCurrency(this.getCurrentDebt(e),e.currency||"USD",this.globalCurrency))}</span>
      </div>
    `,a.querySelectorAll("button[data-action]").forEach(t=>{t.addEventListener("click",i=>{const o=t.getAttribute("data-action"),r=t.getAttribute("data-id");o==="pay"&&this.openPayModal(r),o==="increase"&&this.openIncreaseModal(r),o==="history"&&this.openHistoryModal(r),o==="delete"&&this.openDeleteModal(r)})}),a}formatAmount(e){return Number(e).toLocaleString("es-ES",{minimumFractionDigits:2,maximumFractionDigits:2})}openModal(e){document.getElementById(e).style.display="block"}closeModal(e){document.getElementById(e).style.display="none"}openPayModal(e){this.injectOperationModal("payment",e)}openIncreaseModal(e){this.injectOperationModal("increase",e)}openHistoryModal(e){this.injectHistoryModal(e)}injectOperationModal(e,n){this.removeDynamicModal();const a=this.clients.find(r=>r.id==n);if(!a)return;const t=document.createElement("div");t.className="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60",t.id="dynamicOperationModal";const i=e==="payment"?"Registrar Pago":"Aumentar Deuda",o=e==="payment"?"Registrar Pago":"Aumentar";t.innerHTML=`
      <div class="bg-white rounded-2xl shadow-xl w-full max-w-sm mx-2 p-6 relative flex flex-col animate-fadein">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-xl font-bold">${i} - ${a.name}</h2>
          <button class="modal-close text-gray-500 hover:text-gray-700 text-2xl absolute right-4 top-4">&times;</button>
        </div>
        <form id="operationForm" class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Cantidad</label>
            <input type="number" id="operationAmount" required step="0.01" min="0.01" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent text-lg" placeholder="0.00">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Descripci√≥n</label>
            <input type="text" id="operationDesc" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent text-lg" placeholder="Opcional">
          </div>
          <div class="flex gap-3 pt-4">
            <button type="button" class="modal-close flex-1 bg-gray-300 text-gray-700 py-3 rounded-lg font-medium hover:bg-gray-400 transition-colors text-lg">Cancelar</button>
            <button type="submit" class="flex-1 bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700 transition-colors text-lg">${o}</button>
          </div>
        </form>
      </div>
    `,document.body.appendChild(t),t.querySelectorAll(".modal-close").forEach(r=>r.onclick=()=>this.removeDynamicModal()),t.onclick=r=>{r.target===t&&this.removeDynamicModal()},t.querySelector("#operationForm").onsubmit=r=>{r.preventDefault();const c=parseFloat(t.querySelector("#operationAmount").value),d=t.querySelector("#operationDesc").value||(e==="payment"?"Pago":"Aumento");if(isNaN(c)||c<=0)return alert("Cantidad inv√°lida");this.addHistoryEntry(a.id,e,c,d),this.saveData(),this.renderClients(),this.removeDynamicModal()}}injectHistoryModal(e){this.removeDynamicModal();const n=this.clients.find(t=>t.id==e);if(!n)return;const a=document.createElement("div");a.className="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60",a.id="dynamicHistoryModal",a.innerHTML=`
      <div class="bg-white rounded-2xl shadow-xl w-full max-w-sm mx-2 p-6 relative flex flex-col animate-fadein">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-xl font-bold">Historial - ${n.name}</h2>
          <button class="modal-close text-gray-500 hover:text-gray-700 text-2xl absolute right-4 top-4">&times;</button>
        </div>
        <div class="space-y-2" id="historyList">
          ${n.history.map(t=>`
            <div class="flex justify-between items-center border-b py-1">
              <div>
                <span class="${this.getEntryColor(t.type)} font-bold">${this.getEntryLabel(t.type)}</span>
                <span class="ml-2">${this.getCurrencySymbol(n.currency||"USD")} ${this.formatAmount(t.amount)}</span>
                <span class="ml-2 text-xs text-gray-400">${t.date}</span>
                <span class="ml-2 text-xs text-gray-400">${t.description||""}</span>
              </div>
              ${t.type!=="initial"?`<button class="text-red-600 hover:text-red-800 text-xl" data-opid="${t.id}">üóëÔ∏è</button>`:""}
            </div>
          `).join("")}
        </div>
      </div>
    `,document.body.appendChild(a),a.querySelectorAll(".modal-close").forEach(t=>t.onclick=()=>this.removeDynamicModal()),a.onclick=t=>{t.target===a&&this.removeDynamicModal()},a.querySelectorAll("button[data-opid]").forEach(t=>{t.onclick=()=>{this.currentDeleteOperation={clientId:e,operationId:t.getAttribute("data-opid")},this.removeDynamicModal(),this.openModal("deleteOperationModal")}})}removeDynamicModal(){document.querySelectorAll("#dynamicOperationModal, #dynamicHistoryModal, #dynamicDeleteModal").forEach(e=>e.remove())}openDeleteModal(e){this.currentDeleteId=e,this.removeDynamicModal();const n=document.createElement("div");n.className="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",n.id="dynamicDeleteModal",n.innerHTML=`
      <div class="bg-white rounded-xl shadow-lg w-full max-w-xs mx-2 p-6 flex flex-col items-center">
        <h2 class="text-lg font-semibold mb-4 text-center">¬øEliminar cliente?</h2>
        <div class="flex gap-3 w-full">
          <button id="cancelDelete" class="flex-1 bg-gray-200 text-gray-700 py-2 rounded-lg font-medium hover:bg-gray-300">Cancelar</button>
          <button id="confirmDelete" class="flex-1 bg-red-500 text-white py-2 rounded-lg font-medium hover:bg-red-600">Eliminar</button>
        </div>
      </div>
    `,document.body.appendChild(n),document.getElementById("cancelDelete").onclick=()=>this.removeDynamicModal(),document.getElementById("confirmDelete").onclick=()=>{this.confirmDelete(),this.removeDynamicModal()},n.onclick=a=>{a.target===n&&this.removeDynamicModal()}}togglePaidClients(){document.getElementById("paidClientsContainer").classList.toggle("hidden")}handleAddClient(e){e.preventDefault();const n=document.getElementById("clientName").value,a=parseFloat(document.getElementById("initialDebt").value),t=document.getElementById("clientCurrency").value,i=this.validateClientForm(n,a,t);if(i.length){alert(i.join(`
`));return}const o={id:Date.now()+Math.random(),name:n,currency:t,history:[{id:Date.now()+Math.random(),type:"initial",amount:a,description:"Deuda inicial",date:new Date().toLocaleDateString("es-ES"),timestamp:Date.now()}]};this.clients.push(o),this.saveData(),this.renderClients(),this.closeModal("addClientModal"),document.getElementById("addClientForm").reset()}handleConfigRates(e){e.preventDefault();const n=document.getElementById("fromCurrency").value,a=document.getElementById("toCurrency").value,t=parseFloat(document.getElementById("conversionRate").value);if(n===a){alert("No puedes convertir una moneda a s√≠ misma.");return}if(isNaN(t)||t<=0){alert("La tasa debe ser un n√∫mero positivo.");return}this.exchangeRates[`${n}-${a}`]=t,this.saveData(),this.updateRatesDisplay(),this.closeModal("configRatesModal"),document.getElementById("configRatesForm").reset()}changeGlobalCurrency(e){this.globalCurrency=e,this.saveData(),this.renderClients()}confirmDelete(){this.currentDeleteId&&(this.deleteClient(this.currentDeleteId),this.renderClients(),this.currentDeleteId=null)}confirmDeleteOperation(){if(this.currentDeleteOperation){const{clientId:e,operationId:n}=this.currentDeleteOperation;this.deleteOperation(e,n),this.renderClients(),this.closeModal("deleteOperationModal"),this.currentDeleteOperation=null}}updateGlobalCurrency(){document.getElementById("globalCurrency").value=this.globalCurrency}updateRatesDisplay(){const e=document.getElementById("currentRates");e&&(e.innerHTML=Object.entries(this.exchangeRates).map(([n,a])=>{const[t,i]=n.split("-");return`<div>${this.getCurrencyLabel(t)} ‚Üí ${this.getCurrencyLabel(i)}: <span class="font-bold">${a}</span></div>`}).join("")||'<div class="text-gray-400">No hay tasas configuradas</div>')}setDefaultRates(){Object.keys(this.exchangeRates).length===0&&(this.exchangeRates={"USD-CUP_CASH":120,"USD-CUP_TRANSFER":115,"CUP_CASH-CUP_TRANSFER":.96},this.saveData()),this.updateRatesDisplay()}updateCurrencyLabels(){const e=document.getElementById("fromCurrency").value,n=document.getElementById("toCurrency").value;document.getElementById("fromLabel").textContent=this.getCurrencyLabel(e),document.getElementById("toLabel").textContent=this.getCurrencyLabel(n)}setDefaultRates(){Object.keys(this.exchangeRates).length===0&&(this.exchangeRates={"USD-CUP_CASH":120,"USD-CUP_TRANSFER":115,"CUP_CASH-CUP_TRANSFER":.96},this.saveData())}getExchangeRate(e,n){if(e===n)return 1;const a=`${e}-${n}`,t=`${n}-${e}`;return this.exchangeRates[a]?this.exchangeRates[a]:this.exchangeRates[t]?1/this.exchangeRates[t]:null}convertCurrency(e,n,a){if(n===a)return e;const t=this.getExchangeRate(n,a);if(t)return e*t;const i=["USD","CUP_CASH","CUP_TRANSFER"];for(const o of i)if(o!==n&&o!==a){const r=this.getExchangeRate(n,o),c=this.getExchangeRate(o,a);if(r&&c)return e*r*c}return e}getCurrentDebt(e){return e.history.reduce((n,a)=>{switch(a.type){case"initial":case"increase":return n+a.amount;case"payment":return n-a.amount;default:return n}},0)}isPaidOff(e){const n=this.getCurrentDebt(e);return Math.abs(n)<.01}addHistoryEntry(e,n,a,t){const i=this.clients.find(c=>c.id===e);if(!i)return;let o=arguments[4],r=arguments[5];i.history.push({id:Date.now()+Math.random(),type:n,amount:a,description:t,date:new Date().toLocaleDateString("es-ES"),timestamp:Date.now(),originalAmount:o!==void 0?o:a,originalCurrency:r!==void 0?r:"USD"}),this.saveData()}deleteOperation(e,n){const a=this.clients.find(t=>t.id===e);a&&(a.history=a.history.filter(t=>t.id!==n),this.saveData())}deleteClient(e){this.clients=this.clients.filter(n=>n.id!==e),this.saveData()}saveData(){localStorage.setItem("debtClients",JSON.stringify(this.clients)),localStorage.setItem("exchangeRates",JSON.stringify(this.exchangeRates)),localStorage.setItem("globalCurrency",this.globalCurrency)}getCurrencySymbol(e){return{USD:"$",CUP_CASH:"$",CUP_TRANSFER:"$"}[e]||"$"}getCurrencyLabel(e){return{USD:"USD",CUP_CASH:"CUP Efectivo",CUP_TRANSFER:"CUP Transferencia"}[e]||e}getEntryColor(e){return{initial:"text-blue-600",payment:"text-green-600",increase:"text-red-600"}[e]||"text-gray-600"}getEntryLabel(e){return{initial:"Inicial",payment:"Pago",increase:"Aumento"}[e]||e}validateClientForm(e,n,a){const t=[];return e.trim()?e.trim().length<2&&t.push("El nombre debe tener al menos 2 caracteres"):t.push("El nombre es obligatorio"),(isNaN(n)||n<0)&&t.push("La deuda debe ser un n√∫mero positivo o cero"),["USD","CUP_CASH","CUP_TRANSFER"].includes(a)||t.push("Selecciona una moneda v√°lida"),this.clients.some(i=>i.name.toLowerCase().trim()===e.toLowerCase().trim())&&t.push("Ya existe un cliente con ese nombre"),t}exportData(){const e={clients:this.clients,exchangeRates:this.exchangeRates,globalCurrency:this.globalCurrency,exportDate:new Date().toISOString()},n=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),a=URL.createObjectURL(n),t=document.createElement("a");t.href=a,t.download=`gestor-deudas-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(a)}getStatistics(){const e={totalClients:this.clients.length,activeClients:this.clients.filter(n=>!this.isPaidOff(n)).length,paidClients:this.clients.filter(n=>this.isPaidOff(n)).length,totalDebt:0,totalCredit:0};return this.clients.forEach(n=>{const a=this.getCurrentDebt(n),t=this.convertCurrency(a,"USD",this.globalCurrency);t>0?e.totalDebt+=t:t<0&&(e.totalCredit+=Math.abs(t))}),e}}let s;function m(){document.getElementById("addClientBtn").addEventListener("click",()=>s.openModal("addClientModal")),document.getElementById("configRatesBtn").addEventListener("click",()=>s.openModal("configRatesModal")),document.getElementById("showPaidClientsBtn").addEventListener("click",()=>s.togglePaidClients()),document.getElementById("addClientForm").addEventListener("submit",l=>s.handleAddClient(l)),document.getElementById("configRatesForm").addEventListener("submit",l=>s.handleConfigRates(l)),document.getElementById("globalCurrency").addEventListener("change",l=>s.changeGlobalCurrency(l.target.value)),document.getElementById("fromCurrency").addEventListener("change",()=>s.updateCurrencyLabels()),document.getElementById("toCurrency").addEventListener("change",()=>s.updateCurrencyLabels()),document.querySelectorAll(".modal-close").forEach(l=>{l.addEventListener("click",e=>{const n=e.target.closest(".modal");s.closeModal(n.id)})}),document.querySelectorAll(".modal").forEach(l=>{l.addEventListener("click",e=>{e.target===l&&s.closeModal(l.id)})}),document.getElementById("cancelDelete").addEventListener("click",()=>s.closeModal("deleteModal")),document.getElementById("confirmDelete").addEventListener("click",()=>s.confirmDelete()),document.getElementById("cancelDeleteOperation").addEventListener("click",()=>s.closeModal("deleteOperationModal")),document.getElementById("confirmDeleteOperation").addEventListener("click",()=>s.confirmDeleteOperation())}function g(){s=new u,m(),s.renderClients(),s.updateGlobalCurrency(),s.updateRatesDisplay(),s.setDefaultRates(),s.updateCurrencyLabels()}document.addEventListener("DOMContentLoaded",()=>{g()});

(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))i(t);new MutationObserver(t=>{for(const s of t)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function n(t){const s={};return t.integrity&&(s.integrity=t.integrity),t.referrerPolicy&&(s.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?s.credentials="include":t.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(t){if(t.ep)return;t.ep=!0;const s=n(t);fetch(t.href,s)}})();class d{constructor(){this.clients=JSON.parse(localStorage.getItem("debtClients")||"[]"),this.exchangeRates=JSON.parse(localStorage.getItem("exchangeRates")||"{}"),this.globalCurrency=localStorage.getItem("globalCurrency")||"USD",this.currentDeleteId=null,this.currentDeleteOperation=null}setDefaultRates(){Object.keys(this.exchangeRates).length===0&&(this.exchangeRates={"USD-CUP_CASH":120,"USD-CUP_TRANSFER":115,"CUP_CASH-CUP_TRANSFER":.96},this.saveData())}getExchangeRate(e,n){if(e===n)return 1;const i=`${e}-${n}`,t=`${n}-${e}`;return this.exchangeRates[i]?this.exchangeRates[i]:this.exchangeRates[t]?1/this.exchangeRates[t]:null}convertCurrency(e,n,i){if(n===i)return e;const t=this.getExchangeRate(n,i);if(t)return e*t;const s=["USD","CUP_CASH","CUP_TRANSFER"];for(const l of s)if(l!==n&&l!==i){const o=this.getExchangeRate(n,l),c=this.getExchangeRate(l,i);if(o&&c)return e*o*c}return e}getCurrentDebt(e){return e.history.reduce((n,i)=>{switch(i.type){case"initial":case"increase":return n+i.amount;case"payment":return n-i.amount;default:return n}},0)}isPaidOff(e){const n=this.getCurrentDebt(e);return Math.abs(n)<.01}addHistoryEntry(e,n,i,t){const s=this.clients.find(c=>c.id===e);if(!s)return;let l=arguments[4],o=arguments[5];s.history.push({id:Date.now()+Math.random(),type:n,amount:i,description:t,date:new Date().toLocaleDateString("es-ES"),timestamp:Date.now(),originalAmount:l!==void 0?l:i,originalCurrency:o!==void 0?o:"USD"}),this.saveData()}deleteOperation(e,n){const i=this.clients.find(t=>t.id===e);i&&(i.history=i.history.filter(t=>t.id!==n),this.saveData())}deleteClient(e){this.clients=this.clients.filter(n=>n.id!==e),this.saveData()}saveData(){localStorage.setItem("debtClients",JSON.stringify(this.clients)),localStorage.setItem("exchangeRates",JSON.stringify(this.exchangeRates)),localStorage.setItem("globalCurrency",this.globalCurrency)}getCurrencySymbol(e){return{USD:"$",CUP_CASH:"$",CUP_TRANSFER:"$"}[e]||"$"}getCurrencyLabel(e){return{USD:"USD",CUP_CASH:"CUP Efectivo",CUP_TRANSFER:"CUP Transferencia"}[e]||e}getEntryColor(e){return{initial:"text-blue-600",payment:"text-green-600",increase:"text-red-600"}[e]||"text-gray-600"}getEntryLabel(e){return{initial:"Inicial",payment:"Pago",increase:"Aumento"}[e]||e}validateClientForm(e,n,i){const t=[];return e.trim()?e.trim().length<2&&t.push("El nombre debe tener al menos 2 caracteres"):t.push("El nombre es obligatorio"),(isNaN(n)||n<0)&&t.push("La deuda debe ser un número positivo o cero"),["USD","CUP_CASH","CUP_TRANSFER"].includes(i)||t.push("Selecciona una moneda válida"),this.clients.some(s=>s.name.toLowerCase().trim()===e.toLowerCase().trim())&&t.push("Ya existe un cliente con ese nombre"),t}exportData(){const e={clients:this.clients,exchangeRates:this.exchangeRates,globalCurrency:this.globalCurrency,exportDate:new Date().toISOString()},n=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),i=URL.createObjectURL(n),t=document.createElement("a");t.href=i,t.download=`gestor-deudas-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(i)}getStatistics(){const e={totalClients:this.clients.length,activeClients:this.clients.filter(n=>!this.isPaidOff(n)).length,paidClients:this.clients.filter(n=>this.isPaidOff(n)).length,totalDebt:0,totalCredit:0};return this.clients.forEach(n=>{const i=this.getCurrentDebt(n),t=this.convertCurrency(i,"USD",this.globalCurrency);t>0?e.totalDebt+=t:t<0&&(e.totalCredit+=Math.abs(t))}),e}}let r;function u(){document.getElementById("addClientBtn").addEventListener("click",()=>r.openModal("addClientModal")),document.getElementById("configRatesBtn").addEventListener("click",()=>r.openModal("configRatesModal")),document.getElementById("showPaidClientsBtn").addEventListener("click",()=>r.togglePaidClients()),document.getElementById("addClientForm").addEventListener("submit",a=>r.handleAddClient(a)),document.getElementById("configRatesForm").addEventListener("submit",a=>r.handleConfigRates(a)),document.getElementById("globalCurrency").addEventListener("change",a=>r.changeGlobalCurrency(a.target.value)),document.getElementById("fromCurrency").addEventListener("change",()=>r.updateCurrencyLabels()),document.getElementById("toCurrency").addEventListener("change",()=>r.updateCurrencyLabels()),document.querySelectorAll(".modal-close").forEach(a=>{a.addEventListener("click",e=>{const n=e.target.closest(".modal");r.closeModal(n.id)})}),document.querySelectorAll(".modal").forEach(a=>{a.addEventListener("click",e=>{e.target===a&&r.closeModal(a.id)})}),document.getElementById("cancelDelete").addEventListener("click",()=>r.closeModal("deleteModal")),document.getElementById("confirmDelete").addEventListener("click",()=>r.confirmDelete()),document.getElementById("cancelDeleteOperation").addEventListener("click",()=>r.closeModal("deleteOperationModal")),document.getElementById("confirmDeleteOperation").addEventListener("click",()=>r.confirmDeleteOperation())}function g(){r=new d,u(),r.renderClients(),r.updateGlobalCurrency(),r.updateRatesDisplay(),r.setDefaultRates(),r.updateCurrencyLabels()}document.addEventListener("DOMContentLoaded",()=>{g()});
